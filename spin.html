<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Shangwe Spin Wheel</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #e8f5e9;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        flex-direction: column;
    }

    .container {
        text-align: center;
        width: 100%;
        max-width: 450px;
    }

    #wheelCanvas {
        width: 100%;
        max-width: 350px;
    }

    /* Pointer (right side pointing left) */
    .pointer {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%) rotate(180deg);
        font-size: 60px;
        color: #1b5e20;
        z-index: 999;
    }

    #spinBtn {
        margin-top: 20px;
        background: #2e7d32;
        color: white;
        padding: 15px 40px;
        border: none;
        border-radius: 50px;
        font-size: 20px;
        cursor: pointer;
        transition: 0.3s;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    #spinBtn:hover {
        background: #1b5e20;
        transform: scale(1.05);
    }
</style>
</head>

<body>

<div class="container">
    <h2 style="color:#1b5e20; font-weight:bold;">Safaricom Shangwe Spin</h2>

    <div style="position:relative; display:flex; justify-content:center;">
        <canvas id="wheelCanvas" width="350" height="350"></canvas>

        <!-- Pointer -->
        <div class="pointer">âž¤</div>
    </div>

    <button id="spinBtn">SPIN NOW</button>
</div>

<!-- ðŸ”Š SPIN SOUND -->
<audio id="spinSound" src="https://assets.mixkit.co/sfx/preview/mixkit-fast-energy-whoosh-1325.mp3"></audio>

<!-- ðŸ”Š WIN SOUND -->
<audio id="winSound" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>

<script>
const wheel = document.getElementById("wheelCanvas");
const ctx = wheel.getContext("2d");

const segments = [520000,13000,50000,30000,5000,25000,40000];
const colors = ["#43A047","#4CAF50","#2E7D32","#66BB6A","#1B5E20","#81C784","#4CAF50"];

let startAngle = 0;
let spinTime = 0;
let spinTotalTime = 0;

const spinSound = document.getElementById("spinSound");
const winSound  = document.getElementById("winSound");

function drawWheel() {
    const arc = Math.PI / (segments.length / 2);

    for (let i = 0; i < segments.length; i++) {
        let angle = startAngle + i * arc;

        ctx.fillStyle = colors[i];
        ctx.beginPath();
        ctx.arc(175, 175, 170, angle, angle + arc);
        ctx.arc(175, 175, 0, angle + arc, angle, true);
        ctx.fill();

        ctx.save();
        ctx.translate(
            175 + Math.cos(angle + arc / 2) * 100,
            175 + Math.sin(angle + arc / 2) * 100
        );

        ctx.rotate(angle + arc / 2 + Math.PI / 2);
        ctx.fillStyle = "white";
        ctx.font = "16px Arial";
        ctx.fillText(segments[i], -20, 0);
        ctx.restore();
    }
}

function rotateWheel() {
    spinTime += 20;

    if (spinTime >= spinTotalTime) {
        stopRotate();
        return;
    }

    const spinAngle = easeOut(spinTime, 0, 20, spinTotalTime);
    startAngle += (spinAngle * Math.PI) / 180;

    drawWheel();
    requestAnimationFrame(rotateWheel);
}

function stopRotate() {
    const degrees = (startAngle * 180) / Math.PI + 90;
    const arcDeg = 360 / segments.length;
    const index = Math.floor((360 - (degrees % 360)) / arcDeg);

    winSound.play();

    window.location = "win.html?amount=" + segments[index];
}

function easeOut(t, b, c, d) {
    return c * Math.sin((t / d) * (Math.PI / 2)) + b;
}

document.getElementById("spinBtn").onclick = () => {
    spinSound.play();

    spinTime = 0;
    spinTotalTime = 4000 + Math.random() * 2000; // slower
    rotateWheel();
};

drawWheel();
</script>

</body>
</html>
